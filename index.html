<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<title>ğŸµå©­çš„æ­Œå–®~</title>

<style>
body {
    font-family: "Noto Sans TC", sans-serif;
    background: linear-gradient(135deg, #f1e0ff, #d1ceff);
    min-height: 100vh;
    margin: 0;
    display: flex;
    justify-content: center;
    align-items: center;
}

.card {
    background: #fff;
    width: 460px;
    max-height: 85vh;
    border-radius: 22px;
    padding: 20px;
    box-shadow: 0 12px 30px rgba(0,0,0,.15);
    display: flex;
    flex-direction: column;
}

h1 {
    text-align: center;
    margin: 0 0 12px;
}

input {
    padding: 12px;
    border-radius: 14px;
    border: 2px solid #ffc2d9;
    font-size: 16px;
    outline: none;
}

input:focus {
    border-color: #ff7eb6;
}

.result {
    margin-top: 15px;
    overflow-y: auto;
}

.item {
    background: #e4dbfba6;
    border-radius: 14px;
    padding: 12px;
    margin-bottom: 10px;
    animation: fadeIn .2s ease;
}

.song {
    font-weight: bold;
    font-size: 16px;
}

.meta {
    font-size: 14px;
    color: #555;
    margin-top: 2px;
}
.tag {
    display: inline-block;
    background: #c9c3ff;
    color: #6e22d3;
    padding: 2px 8px;
    border-radius: 999px;
    font-size: 12px;
    margin-right: 4px;
}
.copy-btn {
    border: none;
    background: #c9c3ff;
    color: #6e22d3;
    border-radius: 999px;
    padding: 4px 10px;
    cursor: pointer;
    font-size: 12px;
}

.copy-btn:hover {
    background: #ffb6d5;
}
    
@keyframes fadeIn {
    from { opacity: 0; transform: translateY(5px); }
    to   { opacity: 1; transform: translateY(0); }
}
</style>
</head>

<body>
<div class="card">
    <h1>æ­Œå–®æŸ¥æ­Œ~</h1>
    <input id="kw" placeholder="è¼¸å…¥æ›²å / æ­Œæ‰‹ / èªè¨€â€¦" />
    <div class="result" id="result"></div>
</div>

<script>
/* ===============================
   Google Sheet è¨­å®š
   =============================== */
const SHEET_ID = '1QKdoY1acqW-tqk2K5CJZAzC-mtiUpKzWyE6eVfLbZ34';
const GID = 0;
const SEARCH_FIELDS = ['èªè¨€', 'æ›²å', 'æ­Œæ‰‹', 'ç†Ÿç·´', 'é¡å‹'];
const HEADERS = ['èªè¨€', 'æ›²å', 'æ­Œæ‰‹', 'éŸ³æº(ä¼´å¥)', 'ç†Ÿç·´', 'é¡å‹'];
const CSV_URL =
    `https://docs.google.com/spreadsheets/d/${SHEET_ID}/export?format=csv&gid=${GID}`;

/* ===============================
   è¼‰å…¥æ­Œæ›²è³‡æ–™
   ç¬¬ 2 åˆ—æ˜¯æ¨™é¡Œï¼Œç¬¬ 3 åˆ—é–‹å§‹æ‰æ˜¯è³‡æ–™
   =============================== */
let songs = [];
/*sync function loadSongs() {
    const res = await fetch(CSV_URL);
    const text = await res.text();

    const rows = text.trim().split('\n').map(r => r.split(','));

    // A3:F1000 æ‰æ˜¯è³‡æ–™
    const dataRows = rows.slice(2);

    songs = dataRows.map(r => {
        const obj = {};
        HEADERS.forEach((h, i) => {
            obj[h] = r[i] ? r[i].trim().replace(/^"+|"+$/g,'') : '';
        });
        return obj;
    });
    renderList(songs);
}
*/
async function loadSongs() {
    const res = await fetch(CSV_URL);
    const csvText = await res.text();
    const rows = csvText.split(/\r?\n/).filter(line => line.trim() !== '');

    const dataRows = rows.slice(2);

    // CSV æ­£å‰‡è§£æå‡½å¼
    function parseCSVLine(line) {
        const regex = /(?:^|,)(?:"([^"]*(?:""[^"]*)*)"|([^",]*))/g;
        const result = [];
        let match;
        while ((match = regex.exec(line)) !== null) {
            if (match[1] !== undefined) {
                // å»æ‰å¤–å±¤é›™å¼•è™Ÿã€è½‰æ›å…§éƒ¨é›™å¼•è™Ÿ ""
                result.push(match[1].replace(/""/g,'"').trim());
            } else {
                result.push((match[2] || '').trim());
            }
        }
        return result;
    }

    songs = dataRows.map(r => {
        const fields = parseCSVLine(r);
        const obj = {};
        HEADERS.forEach((h, i) => {
            obj[h] = fields[i] || '';
        });
        return obj;
    });

    // é è¨­é¡¯ç¤ºå…¨éƒ¨
    renderList(songs);
}
loadSongs();

/* ===============================
   å³æ™‚æŸ¥è©¢ï¼ˆæ¯è¼¸å…¥ä¸€å­—ï¼‰
   =============================== */
const input = document.getElementById('kw');
const resultBox = document.getElementById('result');

input.addEventListener('input', () => {
    const kw = input.value.trim().toLowerCase();
    resultBox.innerHTML = '';

    if (!kw) {
        renderList(songs);
        return;
    }

    const matched = songs.filter(song =>
        SEARCH_FIELDS.some(field =>
            song[field]?.toLowerCase().includes(kw)
        )
    );

    matched.forEach(song => {
        const div = document.createElement('div');
        div.className = 'item';

    div.innerHTML = `
        <div style="display:flex; justify-content:space-between; align-items:center;">
            <div class="song">ğŸµ ${song['æ›²å']}</div>
            <button class="copy-btn" onclick="copyText('${song['æ›²å']}')">
                ğŸ“‹ è¤‡è£½
            </button>
        </div>
    
        <div class="meta">ğŸ‘¤ ${song['æ­Œæ‰‹']}</div>
    
        <div class="meta">
            <span class="tag">${song['èªè¨€']}</span>
            <span class="tag">${song['é¡å‹']}</span>
            <span class="tag">ç†Ÿç·´ï¼š${song['ç†Ÿç·´']}</span>
        </div>
    
        ${song['éŸ³æº(ä¼´å¥)'] ? `
        <!--div class="meta">
            ğŸ¹ <a href="${song['éŸ³æº(ä¼´å¥)']}" target="_blank" rel="noopener noreferrer">
                é»æˆ‘è½ä¼´å¥
            </a>
        </div-->` : ''}
    `;
        
        resultBox.appendChild(div);
    });
});
// å°‡æ–‡å­—è¤‡è£½åˆ°å‰ªè²¼ç°¿
function copyText(text) {
    navigator.clipboard.writeText(text).then(() => {
        // å¯æ„›ä¸€é»çš„å³æ™‚å›é¥‹
        alert(`å·²è¤‡è£½ï¼š${text}`);
    });
}
// å°‡æ­Œæ›²æ¸…å–®æ¸²æŸ“åˆ°ç•«é¢
function renderList(list) {
    const resultBox = document.getElementById('result');
    resultBox.innerHTML = '';

    list.forEach(song => {
        const div = document.createElement('div');
        div.className = 'item';

        div.innerHTML = `
            <div style="display:flex; justify-content:space-between; align-items:center;">
                <div class="song">ğŸµ ${song['æ›²å']}</div>
                <button class="copy-btn" onclick="copyText('${song['æ›²å']}')">
                    ğŸ“‹ è¤‡è£½
                </button>
            </div>

            <div class="meta">ğŸ‘¤ ${song['æ­Œæ‰‹']}</div>

            <div class="meta">
                <span class="tag">${song['èªè¨€']}</span>
                <span class="tag">${song['é¡å‹']}</span>
                <span class="tag">ç†Ÿç·´ï¼š${song['ç†Ÿç·´']}</span>
            </div>

            ${song['éŸ³æº(ä¼´å¥)'] ? `
            <!--div class="meta">
                ğŸ¹ <a href="${song['éŸ³æº(ä¼´å¥)']}"
                     target="_blank"
                     rel="noopener noreferrer">
                    é»æˆ‘è½ä¼´å¥
                </a>
            </div-->` : ''}
        `;

        resultBox.appendChild(div);
    });
}

</script>
</body>
</html>
